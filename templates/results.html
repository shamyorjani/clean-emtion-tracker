<!DOCTYPE html>
<html lang="en">

  {% include 'header.html' %}
  <!-- <body class="bg-gradient-to-r from-[#26292e] to-[#26292d]"> -->
  <!-- #2c2f35 -->
  <!-- #181b1f -->

  <body class="bg-[#181b1f] overflow-hidden"
    x-data="{controls:false, mobileHome:true, mobileAlbums:false, mobileArtist:false, desktopNavSearchopen:false}">
<script>
  
  async function fetchEmotion() {
      const response = await fetch("/emotion");
      const data = await response.json();
      document.getElementById("emotion_result").textContent =
        "Detected Emotion: " + data.emotion;
    }
  fetchEmotion();
  
</script>
    <div id="fullscreen-animator"></div>

    <div class="loader-container">
      <div class="lds-ripple">
        <div></div>
        <div></div>
      </div>
    </div>
    <div class="main">
      <div class="player-loader">
        <div class="lds-ripple">
          <div></div>
          <div></div>
        </div>
      </div>
    </div>
    <!-- desktop -->
    <main class="app main-desktop section overflow-x-hidden" id="top-section">
      {% include 'desktop/navbar.html' %}
      <!-- <button style="color: white;font-size: 30px;" class="playsong">play song</button>
      
      <button class="next-button text-white">next song</button> -->
   
    
      <section class="grid 2xl:w-[90%] xl:w-[88%] lg:w-[80%] md:w-[80%] overflow-hidden">
        {% include 'desktop/first-section.html' %}

        <!-- audio player starts here -->
        {% include 'desktop/audio-player.html' %}
        <!-- audio player ends here -->

        <!-- playlist starts here -->
        {% include 'desktop/recentlyPlayed.html' %}
        <!-- playlist ends here -->
      </section>
    </main>

    <!-- bottom section -->
    <section class="w-[100%] lg:flex lg:flex-row hidden section" id="bottom-section">
      <!-- left media plyaer -->
      {% include 'desktop/bottom-left-media-player.html' %}
      <!-- left media plyaer ends -->

      <div class="text-white">
        <!-- <button id="connectBtn">Connect to Spotify</button> -->
    <!-- <div id="playlistContainer"></div>
    <h1>Users Playlists</h1>
    <div id="userPlaylists"></div>
    <h1>Users Top Tracks</h1>
    <div id="topTracks"></div>
    <h1>users profile</h1> -->
    <!-- <div id="userProfile"></div> -->
    <!-- <h1>recently played tracks</h1> -->
    <!-- <div id="recentlyPlayedContainer"></div> -->

      </div>

      <!-- albums playlist -->
      {% include 'desktop/albums-playlist.html' %}
      
    </section>
    <!-- end bottom section -->
    <!-- end desktop view -->

    <!-- mobile view  -->

    <!-- now playing mobile view -->
    <!-- mobile navigation  -->
    <div :class="mobileHome ? '': 'hidden' " class="mobile-main-container-of-every-page">

      {% include 'mobile/navbar.html' %}
      <!-- end mobile navigation -->

      <main class="mobile-main">
        <!-- mobile mid content player -->
        {% include 'mobile/media-player.html' %}
        <!-- next and previous text -->
        <div class="mobile-next-previous-bottom-text">
          <div class="up-next-text">
            <div>
              Up Next
            </div>
            <div class="next-song-name">
              "Adele - Hello"
            </div>
          </div>
          <!-- end mobile mid content player -->
          <div class="previous-text">
            <div>
              Previous
            </div>
            <div class="previous-song-name">
              "Ayu Tingting - Alamat Paisu"
            </div>
          </div>
        </div>
        <!-- end next and previous text -->

        <!-- controls starts here -->
        {% include 'mobile/controls.html' %}
        <!-- controls ends here -->
      </main>

    </div>
    <!-- end mobile view -->
    <!-- end now playing mobile view -->

    <!-- albums playlist -->
    <!-- mobile navigation  -->
    <div :class="mobileAlbums ? '':'hidden' " class="mobile-main-container-of-every-page">

      {% include 'mobile/albums/navbar.html' %}
      <!-- end mobile navigation -->
      {% include 'mobile/albums/albums-tabs.html' %}
      <main class="mobile-albums-main">

        {% include 'mobile/albums/albums-main.html' %}

        {% include 'mobile/albums/play-btn.html' %}
      </main>

    </div>
    <!-- end albums playlist -->

    <!-- artist profile -->

    <main class="artist-profile-main mobile-main-container-of-every-page" id=" artist"
      :class="mobileArtist ? '':'hidden' ">
      {% include 'mobile/artist/navbar.html' %}
      <div class="artist-main-background bg-[url('../static/assets/images/girl-with-light-2.jpg')]"></div>
      {% include 'mobile/artist/upper-part.html' %}

      {% include 'mobile/artist/bottom-player.html' %}
      </div>
    </main>
    <!-- end artist profile -->
    {% include 'audio-player.html' %}
    {% include 'footer.html' %}

    <script>

      async function connectToSpotify() {
        const clientId = "23ab69c678df492d958a9220fb60bfe9";
        const redirectUri = "http://localhost:5000/callback";
        const scope =
          "playlist-read-private user-top-read user-read-private user-read-email user-read-recently-played user-read-currently-playing user-modify-playback-state user-read-playback-state streaming"; // Add additional scopes if needed

        const authUrl = `https://accounts.spotify.com/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=token`;

        localStorage.setItem("sessionStartTime", Date.now());

        window.location.href = authUrl;
      }
      
      window.addEventListener('load', function() {

        document.querySelector(".pauseBtn").style.display = "none";        
        const loader = document.querySelector('.loader-container');
        setTimeout(() => {
          loader.style.display = 'none';
        }, 3000);
      });


      // Check session timeout periodically
      setInterval(() => {
        // Get session start time from local storage
        const sessionStartTime = localStorage.getItem("sessionStartTime");
        
        // Check if session start time is set
        if (sessionStartTime) {
          const currentTime = Date.now();
          const timeoutDuration = 58 * 60 * 1000; // 58 minutes in milliseconds
          
          // Calculate session expiration time
          const sessionExpirationTime = parseInt(sessionStartTime) + timeoutDuration;
          
          // Check if session has expired
          if (currentTime >= sessionExpirationTime) {
            // Redirect to login page
            connectToSpotify();
            
            // Clear session start time from local storage
            localStorage.removeItem("sessionStartTime");
          }
        }
      }, 1000);
    </script>

    
    

  </body>

</html>